<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>SMURD Cloud - Mobil Optimizat</title>
  
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

  <style>
    :root { 
      --primary: #2563eb; --danger: #ef4444; --success: #22c55e; 
      --gray: #64748b; --light-gray: #f1f5f9; 
    }

    body { 
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
      background: #f8fafc; margin: 0; padding: 10px; color: #1e293b;
    }

    .container { 
      max-width: 1000px; margin: auto; background: white; 
      padding: 15px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    }

    /* GRID RECEPTIV: 2 coloane pe PC, 1 coloană pe Mobil */
    .grid { 
      display: grid; grid-template-columns: 1fr; gap: 20px; 
    }
    @media (min-width: 768px) {
      .grid { grid-template-columns: 1.2fr 1fr; }
      body { padding: 20px; }
      .container { padding: 25px; }
    }

    /* CALENDAR OPTIMIZAT */
    .calendar { 
      display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 10px; 
    }
    .calendar button { 
      aspect-ratio: 1 / 1; padding: 5px; border-radius: 8px; border: 1px solid #e2e8f0; 
      background: white; font-weight: 600; font-size: 14px; cursor: pointer; transition: 0.2s;
    }
    .day-free { background: #ecfdf5 !important; color: #059669; border-color: #10b981 !important; }
    .day-full { background: #f1f5f9 !important; color: #94a3b8 !important; cursor: not-allowed; text-decoration: line-through; }
    .calendar button.selected { background: var(--primary) !important; color: white !important; transform: scale(0.95); }

    /* SLOTURI ORARE - Butoane mai mari pe mobil */
    .time-grid { 
      display: grid; grid-template-columns: repeat(auto-fill, minmax(75px, 1fr)); 
      gap: 10px; margin-top: 10px; max-height: 350px; overflow-y: auto; padding: 5px;
    }
    .time-slot { 
      padding: 15px 5px; border: 1px solid #e2e8f0; border-radius: 10px; 
      text-align: center; font-size: 14px; font-weight: 600; background: #fff;
    }
    .time-slot.active { background: var(--primary); color: white; border-color: var(--primary); }
    .time-slot.taken { background: #fee2e2; color: #ef4444; border-color: #fecaca; text-decoration: line-through; }
    .time-slot.in-range { background: #dbeafe; border-color: var(--primary); }

    /* INPUTS & BUTTONS */
    input[type="text"] { 
      width: 100%; padding: 14px; border-radius: 10px; border: 2px solid #e2e8f0; 
      font-size: 16px; margin-bottom: 10px; box-sizing: border-box; 
    }
    input[type="text"]:focus { border-color: var(--primary); outline: none; }
    
    .confirm-btn { 
      width: 100%; padding: 16px; background: var(--success); color: white; 
      border: none; border-radius: 10px; font-weight: bold; font-size: 16px; 
      cursor: pointer; margin-top: 10px; box-shadow: 0 4px 6px -1px rgba(34, 197, 94, 0.4);
    }

    /* TABEL ADMIN RECEPTIV */
    .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
    th, td { padding: 12px 8px; border-bottom: 1px solid #e2e8f0; text-align: left; }
    th { background: #f8fafc; color: var(--gray); text-transform: uppercase; font-size: 11px; }

    .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .status-msg { font-size: 13px; font-weight: bold; margin-bottom: 10px; }

    @media print { .no-print { display: none !important; } }
  </style>
</head>
<body>

<div class="container">
  <div class="top-bar">
    <div>
      <h2 style="margin:0; color:var(--danger); font-size: 1.2rem;">Rezervări Voluntari</h2>
      <small id="syncStatus">☁️ Sincronizat în Cloud</small>
    </div>
    <button onclick="adminLogin()" class="no-print" style="padding: 6px 12px; border-radius: 6px; font-size: 12px;">Admin</button>
  </div>

  <div class="grid no-print">
    <div>
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
        <button onclick="changeMonth(-1)">«</button>
        <strong id="monthLabel"></strong>
        <button onclick="changeMonth(1)">»</button>
      </div>
      <div class="calendar" id="calendar"></div>
    </div>

    <div>
      <input type="text" id="name" placeholder="Nume și Prenume" oninput="handleNameInput()" autocomplete="name">
      <div id="bookingCount" class="status-msg"></div>
      <div id="selectedDateLabel" style="font-weight:bold; margin-bottom:10px; color: var(--primary);">Selectați o zi...</div>
      
      <div style="font-size: 12px; color: var(--gray); margin-bottom: 5px;">Atinge ora de început și ora de final:</div>
      <div class="time-grid" id="timeGrid"></div>
      
      <button class="confirm-btn" onclick="confirmBooking()">Confirmă Rezervarea</button>
    </div>
  </div>

  <div class="admin" id="adminView" style="display:none;">
    <hr>
    <h3 style="text-align:center;">Listă Rezervări (Admin)</h3>
    <div class="table-container">
      <table>
        <thead>
          <tr><th>Nume</th><th>Data</th><th>Interval</th><th class="no-print">Acțiuni</th></tr>
        </thead>
        <tbody id="adminTable"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
  // CONFIGURARE FIREBASE (Înlocuiește cu ale tale)
const firebaseConfig = {
  apiKey: "AIzaSyDlpy92yTmFVzrvF5sGfT50pEipMx3k2Pg",
  authDomain: "rezervari-smurd.firebaseapp.com",
  databaseURL: "https://rezervari-smurd-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "rezervari-smurd",
  storageBucket: "rezervari-smurd.firebasestorage.app",
  messagingSenderId: "694856921809",
  appId: "1:694856921809:web:de6e004fd6a9cd5f4c0bf0",
  measurementId: "G-9J65W91YHD"
};

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const START_H = 8, END_H = 22, ADMIN_PASS = "admin1234*";
  let curDate = new Date(), selDate = null, selStart = null, selEnd = null, bookings = [];
  const slots = [];
  for(let i=START_H; i<=END_H; i++) slots.push(`${String(i).padStart(2,'0')}:00`);

  // Ascultă schimbările din Cloud
  db.ref('bookings').on('value', snap => {
    const val = snap.val();
    bookings = val ? Object.values(val) : [];
    renderCalendar(); renderTimeSlots(); renderAdmin();
  });

  function getCleanCount(name, date) {
    if(!name || !date) return 0;
    const n = name.trim().toLowerCase();
    return bookings.filter(b => 
      b.name.trim().toLowerCase() === n && 
      new Date(b.date).getMonth() === date.getMonth() &&
      new Date(b.date).getFullYear() === date.getFullYear()
    ).length;
  }

  function confirmBooking() {
    const n = document.getElementById("name").value.trim();
    if(!n || !selDate || selStart===null || selEnd===null) return alert("Completează tot!");
    if(getCleanCount(n, selDate) >= 2) return alert("Ai deja 2 rezervări luna aceasta!");

    const id = Date.now();
    const data = {
      id, name: n, date: selDate.toISOString(),
      start: slots[selStart], end: slots[selEnd],
      createdAt: new Date().toLocaleString('ro-RO')
    };

    db.ref('bookings/'+id).set(data).then(() => {
      alert("Rezervare confirmată!");
      selStart = null; selEnd = null; renderTimeSlots();
    });
  }

  function isDayFull(d) {
    const dayB = bookings.filter(b => new Date(b.date).toDateString() === d.toDateString());
    for(let i=0; i<slots.length-1; i++) {
      if(!dayB.some(b => slots[i] >= b.start && slots[i] < b.end)) return false;
    }
    return dayB.length > 0;
  }

  function renderCalendar() {
    const cal = document.getElementById("calendar"); cal.innerHTML = "";
    document.getElementById("monthLabel").innerText = curDate.toLocaleString('ro-RO',{month:'long',year:'numeric'});
    const y = curDate.getFullYear(), m = curDate.getMonth();
    const totalDays = new Date(y, m+1, 0).getDate();

    for(let i=1; i<=totalDays; i++) {
      const d = new Date(y, m, i);
      const btn = document.createElement("button");
      btn.innerText = i;
      if(isDayFull(d)) btn.className = "day-full";
      else {
        btn.className = "day-free";
        btn.onclick = () => { 
          selDate = d; selStart = null; selEnd = null;
          document.getElementById("selectedDateLabel").innerText = "Data: " + d.toLocaleDateString('ro-RO');
          renderCalendar(); renderTimeSlots(); handleNameInput();
        };
      }
      if(selDate && d.toDateString() === selDate.toDateString()) btn.classList.add("selected");
      cal.appendChild(btn);
    }
  }

  function renderTimeSlots() {
    const grid = document.getElementById("timeGrid"); grid.innerHTML = "";
    if(!selDate) return;
    const dayB = bookings.filter(b => new Date(b.date).toDateString() === selDate.toDateString());

    slots.forEach((s, i) => {
      const div = document.createElement("div");
      div.className = "time-slot"; div.innerText = s;
      if(dayB.some(b => s >= b.start && s < b.end)) div.classList.add("taken");
      else {
        div.onclick = () => {
          if(selStart === null || (selStart !== null && selEnd !== null)) { selStart = i; selEnd = null; }
          else { selEnd = i < selStart ? selStart : i; if(i < selStart) selStart = i; }
          renderTimeSlots();
        };
        if(selStart === i || selEnd === i) div.classList.add("active");
        if(selStart !== null && selEnd !== null && i > selStart && i < selEnd) div.classList.add("in-range");
      }
      grid.appendChild(div);
    });
  }

  function handleNameInput() {
    const n = document.getElementById("name").value;
    const c = getCleanCount(n, selDate || curDate);
    const el = document.getElementById("bookingCount");
    el.innerText = n.trim() ? `Rezervări: ${c} / 2` : "";
    el.style.color = c >= 2 ? "var(--danger)" : "var(--primary)";
  }

  function changeMonth(offset) { curDate.setMonth(curDate.getMonth() + offset); renderCalendar(); }
  function adminLogin() { if(prompt("Parola admin:") === ADMIN_PASS) document.getElementById("adminView").style.display = "block"; }
  function deleteBooking(id) { if(confirm("Ștergi?")) db.ref('bookings/'+id).remove(); }

  function renderAdmin() {
    const t = document.getElementById("adminTable"); t.innerHTML = "";
    [...bookings].sort((a,b)=>new Date(a.date)-new Date(b.date)).forEach(b => {
      t.innerHTML += `<tr><td>${b.name}</td><td>${new Date(b.date).toLocaleDateString('ro-RO')}</td><td>${b.start}-${b.end}</td><td><button onclick="deleteBooking(${b.id})" class="no-print">❌</button></td></tr>`;
    });
  }

  renderCalendar();
</script>
</body>
</html>
