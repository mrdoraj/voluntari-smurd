<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistem de Rezervări SMURD</title>
  <style>
    :root { --primary: #2563eb; --danger: #ef4444; --success: #22c55e; --gray: #94a3b8; --light-gray: #e2e8f0; }
    body { font-family: 'Segoe UI', Arial, sans-serif; background:#f4f6f9; margin:0; padding:20px; color: #1e293b; }
    .container { max-width:1100px; margin:auto; background:white; padding:25px; border-radius:16px; box-shadow:0 10px 25px rgba(0,0,0,0.05);} 
    .grid { display:grid; grid-template-columns: 1.2fr 1fr; gap:30px; }
    
    /* Calendar */
    .calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:8px; margin-top:10px; }
    .calendar button { padding:12px 5px; border-radius:8px; border:1px solid #e2e8f0; cursor:pointer; font-weight: 600; transition: 0.2s; }
    
    /* Culori Calendar conform solicitării */
    .day-free { background: var(--success) !important; color: white; border: none; }
    .day-full { background: #cbd5e1 !important; color: #64748b !important; cursor: not-allowed !important; border: none; text-decoration: line-through; }
    .calendar button.selected { background: var(--primary) !important; color:white !important; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.3); }

    /* Sloturi Orare */
    .time-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 8px; margin-top: 15px; max-height: 300px; overflow-y: auto; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; }
    .time-slot { padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; text-align: center; cursor: pointer; font-size: 14px; transition: 0.2s; font-weight: 500; background: white; }
    .time-slot:hover:not(.taken) { border-color: var(--primary); background: #eff6ff; }
    .time-slot.active { background: var(--primary); color: white; border-color: var(--primary); }
    .time-slot.taken { background: #fee2e2; color: #b91c1c; border-color: #fecaca; cursor: not-allowed; text-decoration: line-through; }
    .time-slot.in-range { background: #dbeafe; border-color: var(--primary); }

    input { padding:12px; width:100%; box-sizing: border-box; margin-bottom:15px; border-radius:8px; border:1px solid #ccc; font-size: 16px; }
    button.confirm-btn { width: 100%; padding: 14px; background: var(--success); color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; margin-top: 15px; }
    .admin { margin-top:40px; border-top: 2px solid #eee; padding-top: 20px; }
    .admin-actions { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
    table { width:100%; border-collapse:collapse; margin-top:15px; }
    th, td { border:1px solid #e2e8f0; padding:12px; text-align: left; }
    th { background:#f8fafc; }
    .top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
    .legend { font-size: 12px; color: #64748b; margin-bottom: 10px; }

    @media print {
      .no-print { display: none !important; }
      th:last-child, td:last-child { display: none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="top-bar">
      <div>
        <h1 style="margin:0; color:var(--danger)">Sistem Rezervări Voluntari</h1>
        <small>ISU Prahova - Detașamentul 1 Ploiești</small>
      </div>
      <button onclick="adminLogin()" class="no-print" style="background:none; border:1px solid #ccc; border-radius:6px; padding:5px 10px; cursor:pointer;">Admin</button>
    </div>

    <div class="grid no-print">
      <div>
        <div class="top-bar">
          <button onclick="changeMonth(-1)">«</button>
          <h3 id="monthLabel" style="margin:0"></h3>
          <button onclick="changeMonth(1)">»</button>
        </div>
        <div class="calendar" id="calendar"></div>
        <div style="margin-top:10px; font-size:12px;">
            <span style="color:var(--success)">● Verde</span> = Disponibil | 
            <span style="color:#64748b">● Gri</span> = Ocupat Integral
        </div>
      </div>

      <div>
        <input type="text" id="name" placeholder="Nume și Prenume" oninput="handleNameInput()" />
        <div id="bookingCount" style="font-weight:bold; color:var(--primary); margin-bottom:10px;"></div>
        <div id="selectedDateLabel" style="font-weight:bold; margin-bottom:5px;">Selectați o zi din calendar</div>
        <div class="legend">Click pe ora de <b>start</b> și pe ora de <b>final</b>.</div>
        <div class="time-grid" id="timeGrid"></div>
        <button class="confirm-btn" onclick="confirmBooking()">Confirmă Rezervarea</button>
      </div>
    </div>

    <div class="admin" id="adminView" style="display:none;">
      <h2 style="text-align: center;">Panou Administrator</h2>
      <div class="admin-actions no-print">
        <button onclick="exportToJSON()" style="padding: 8px; background: #334155; color: white; border: none; border-radius: 4px; cursor:pointer;">Exportă JSON</button>
        <button onclick="document.getElementById('importFile').click()" style="padding: 8px; background: #64748b; color: white; border: none; border-radius: 4px; cursor:pointer;">Importă JSON</button>
        <button onclick="window.print()" style="padding: 8px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor:pointer;">Printează Lista</button>
        <input type="file" id="importFile" style="display:none" accept=".json" onchange="importFromJSON(event)">
      </div>
      <table>
        <thead>
          <tr><th>Nume</th><th>Data</th><th>Interval</th><th class="no-print">Acțiuni</th></tr>
        </thead>
        <tbody id="adminTable"></tbody>
      </table>
    </div>
  </div>

<script>
  const BUSINESS_START = 8;
  const BUSINESS_END = 22;
  const ADMIN_PASSWORD = "admin1234*";

  let currentDate = new Date();
  let selectedDate = null;
  let selectionStart = null; 
  let selectionEnd = null;   
  let bookings = JSON.parse(localStorage.getItem('smurd_bookings')) || [];

  const timeSlots = [];
  for(let h=BUSINESS_START; h<=BUSINESS_END; h++) { timeSlots.push(`${String(h).padStart(2,'0')}:00`); }

  function save() { localStorage.setItem('smurd_bookings', JSON.stringify(bookings)); }

  function isDayFull(date) {
    const dayStr = date.toDateString();
    const dayBookings = bookings.filter(b => new Date(b.date).toDateString() === dayStr);
    
    // Verificăm dacă toate intervalele orare sunt acoperite
    for(let i=0; i < timeSlots.length - 1; i++) {
        const time = timeSlots[i];
        const isSlotTaken = dayBookings.some(b => time >= b.start && time < b.end);
        if(!isSlotTaken) return false; // Dacă găsim măcar un slot liber, ziua nu e plină
    }
    return dayBookings.length > 0; // E plină doar dacă are rezervări care acoperă tot
  }

  function renderCalendar(){
    const cal=document.getElementById("calendar");
    cal.innerHTML="";
    document.getElementById("monthLabel").innerText = currentDate.toLocaleString('ro-RO',{month:'long',year:'numeric'});
    
    const y=currentDate.getFullYear(), m=currentDate.getMonth();
    const days=new Date(y,m+1,0).getDate();

    for(let d=1; d<=days; d++){
      const date=new Date(y,m,d);
      const btn=document.createElement("button");
      btn.textContent=d;
      
      const full = isDayFull(date);
      if(full) {
          btn.classList.add("day-full");
          btn.disabled = true;
      } else {
          btn.classList.add("day-free");
          btn.onclick=()=> {
            selectedDate = new Date(y,m,d);
            selectionStart = null; selectionEnd = null;
            document.getElementById("selectedDateLabel").innerText = "Data: " + selectedDate.toLocaleDateString('ro-RO');
            renderTimeSlots(); renderCalendar();
          };
      }

      if(selectedDate && date.toDateString() === selectedDate.toDateString()) btn.classList.add("selected");
      cal.appendChild(btn);
    }
  }

  function renderTimeSlots(){
    const grid = document.getElementById("timeGrid");
    grid.innerHTML = "";
    if(!selectedDate) return;
    const dayBookings = bookings.filter(b => new Date(b.date).toDateString() === selectedDate.toDateString());

    timeSlots.forEach((time, index) => {
      const slotDiv = document.createElement("div");
      slotDiv.className = "time-slot";
      slotDiv.innerText = time;
      const isTaken = dayBookings.some(b => time >= b.start && time < b.end);
      if(isTaken) {
        slotDiv.classList.add("taken");
      } else {
        slotDiv.onclick = () => handleSlotClick(index);
        if(selectionStart === index || selectionEnd === index) slotDiv.classList.add("active");
        if(selectionStart !== null && selectionEnd !== null && index > selectionStart && index < selectionEnd) slotDiv.classList.add("in-range");
      }
      grid.appendChild(slotDiv);
    });
  }

  function handleSlotClick(index){
    if(selectionStart === null || (selectionStart !== null && selectionEnd !== null)) {
      selectionStart = index; selectionEnd = null;
    } else {
      if(index < selectionStart) { selectionEnd = selectionStart; selectionStart = index; } 
      else if (index > selectionStart) {
        const hasConflict = Array.from({length: index - selectionStart}, (_, i) => selectionStart + i)
          .some(idx => bookings.some(b => new Date(b.date).toDateString() === selectedDate.toDateString() && timeSlots[idx] >= b.start && timeSlots[idx] < b.end));
        if(hasConflict) { alert("Intervalul include ore ocupate!"); selectionStart = index; selectionEnd = null; } 
        else { selectionEnd = index; }
      } else { selectionStart = null; selectionEnd = null; }
    }
    renderTimeSlots();
  }

  function confirmBooking(){
    const name = document.getElementById("name").value.trim();
    if(!name || !selectedDate || selectionStart === null || selectionEnd === null) return alert("Date incomplete!");
    const monthlyCount = bookings.filter(b => b.name === name && new Date(b.date).getMonth() === selectedDate.getMonth()).length;
    if(monthlyCount >= 2) return alert("Limita de 2/lună atinsă!");

    bookings.push({ id: Date.now(), name, date: selectedDate.toISOString(), start: timeSlots[selectionStart], end: timeSlots[selectionEnd] });
    save(); 
    alert("Rezervare salvată!");
    selectionStart = null; selectionEnd = null;
    renderTimeSlots(); renderCalendar(); updateBookingCount(name); renderAdmin();
  }

  function exportToJSON() {
    const blob = new Blob([JSON.stringify(bookings, null, 2)], { type: "application/json" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `smurd_backup.json`;
    link.click();
  }

  function importFromJSON(event) {
    const reader = new FileReader();
    reader.onload = (e) => { 
        bookings = JSON.parse(e.target.result); save(); 
        renderAdmin(); renderCalendar(); alert("Import reușit!"); 
    };
    reader.readAsText(event.target.files[0]);
  }

  function updateBookingCount(name){
    if(!name) return document.getElementById("bookingCount").innerText = "";
    const count = bookings.filter(b => b.name === name && new Date(b.date).getMonth() === currentDate.getMonth()).length;
    document.getElementById("bookingCount").innerText = `Rezervări lunare: ${count} / 2`;
  }

  function handleNameInput(){ updateBookingCount(document.getElementById("name").value.trim()); }
  function changeMonth(offset){ currentDate.setMonth(currentDate.getMonth() + offset); renderCalendar(); }
  function adminLogin(){ if(prompt("Parolă admin:") === ADMIN_PASSWORD) { document.getElementById("adminView").style.display = "block"; renderAdmin(); } }
  function deleteBooking(id){ if(confirm("Ștergi?")){ bookings = bookings.filter(b => b.id !== id); save(); renderAdmin(); renderTimeSlots(); renderCalendar(); } }

  function renderAdmin(){
    const table = document.getElementById("adminTable");
    table.innerHTML = "";
    [...bookings].sort((a,b)=> new Date(a.date) - new Date(b.date)).forEach(b => {
      table.innerHTML += `<tr><td>${b.name}</td><td>${new Date(b.date).toLocaleDateString('ro-RO')}</td><td>${b.start} - ${b.end}</td><td class="no-print"><button onclick="deleteBooking(${b.id})" style="color:red; cursor:pointer;">Șterge</button></td></tr>`;
    });
  }
  renderCalendar();
</script>
</body>
</html>